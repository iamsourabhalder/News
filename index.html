<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blogger CMS - GitHub Sync</title>
    <style>
        /* Base Reset & Variables */
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg: #f9fafb;
            --text-main: #111827;
            --text-muted: #6b7280;
            --white: #ffffff;
            --border: #e5e7eb;
            --success: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            line-height: 1.5;
        }

        .container { max-width: 1000px; margin: 0 auto; padding: 0 1.5rem; }
        .hidden { display: none !important; }

        /* Navigation */
        nav {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border);
            height: 64px;
            display: flex;
            align-items: center;
        }

        .nav-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }

        .logo { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: 700; font-size: 1.25rem; }

        .logo-icon {
            width: 32px; height: 32px; background: var(--primary); color: white;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
        }

        .btn-new {
            background: #111827; color: white; padding: 0.5rem 1rem; border-radius: 8px;
            border: none; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;
        }

        /* Post Grid */
        .posts-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;
        }

        .post-card {
            background: var(--white); border-radius: 1rem; overflow: hidden;
            border: 1px solid var(--border); cursor: pointer; transition: transform 0.2s;
        }

        .post-card:hover { transform: translateY(-4px); }
        .post-card img { width: 100%; height: 180px; object-fit: cover; background: #eee; }
        .post-card-body { padding: 1.25rem; }

        /* Form Styling */
        .admin-form-card {
            background: var(--white); padding: 2rem; border-radius: 1.5rem;
            border: 1px solid var(--border); margin-bottom: 2rem;
        }

        .form-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem; }
        input, textarea {
            width: 100%; padding: 0.75rem; border-radius: 0.5rem;
            border: 1px solid var(--border); outline: none; font-family: inherit;
        }

        .image-upload-area {
            border: 2px dashed var(--border); padding: 1rem; border-radius: 0.5rem;
            text-align: center; cursor: pointer; background: #fafafa;
        }

        .btn-primary {
            background: var(--primary); color: white; padding: 0.75rem 1.5rem;
            border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;
        }

        .github-config {
            background: #f1f5f9; padding: 1rem; border-radius: 0.5rem; margin-top: 2rem; font-size: 0.8rem;
        }

        /* Icons */
        .icon { width: 18px; height: 18px; fill: currentColor; }
    </style>
</head>
<body>

    <nav>
        <div class="container nav-content">
            <div class="logo" onclick="showHome()">
                <div class="logo-icon">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                </div>
                <span>DevBlog</span>
            </div>
            <button onclick="showAdmin()" class="btn-new">Admin Panel</button>
        </div>
    </nav>

    <main class="container py-10">
        <div id="feed-view">
            <h1 style="margin-bottom: 2rem;">Recent Posts</h1>
            <div id="posts-container" class="posts-grid"></div>
        </div>

        <div id="admin-view" class="hidden">
            <div class="admin-form-card">
                <h2 style="margin-bottom: 1.5rem;">New Article</h2>
                <form id="post-form" onsubmit="handlePostSubmit(event)">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="post-title" required>
                    </div>
                    <div class="form-group">
                        <label>Post Image</label>
                        <div class="image-upload-area" onclick="document.getElementById('file-input').click()">
                            <p id="file-label">Click to upload image or enter URL below</p>
                            <input type="file" id="file-input" class="hidden" accept="image/*" onchange="previewImage(this)">
                        </div>
                        <input type="text" id="post-image-url" placeholder="Or paste Image URL" style="margin-top: 0.5rem;">
                    </div>
                    <div class="form-group">
                        <label>Excerpt</label>
                        <textarea id="post-excerpt" rows="2" required></textarea>
                    </div>
                    <button type="submit" class="btn-primary">Add Local Post</button>
                </form>

                <div class="github-config">
                    <h3 style="margin-bottom: 0.5rem;">GitHub Sync Configuration</h3>
                    <p style="margin-bottom: 1rem; color: var(--text-muted);">Sync your posts to a `data.json` file in your repository.</p>
                    <div class="form-group">
                        <input type="password" id="gh-token" placeholder="GitHub Personal Access Token">
                    </div>
                    <div class="form-group">
                        <input type="text" id="gh-repo" placeholder="username/repo-name">
                    </div>
                    <button onclick="syncToGitHub()" class="btn-primary" style="background: #000; width: 100%;">
                        Save & Sync to GitHub
                    </button>
                    <p id="sync-status" style="margin-top: 0.5rem; font-weight: bold;"></p>
                </div>
            </div>
        </div>

        <div id="post-view" class="hidden">
            <button onclick="showHome()" style="background:none; border:none; color:var(--primary); cursor:pointer; margin-bottom:2rem;">‚Üê Back</button>
            <article id="post-detail-content" style="background:white; padding:2rem; border-radius:1rem; border:1px solid var(--border);"></article>
        </div>
    </main>

    <script>
        let POSTS_DATA = [];
        let base64Image = "";

        // On Load: Try to load from local storage first
        window.onload = () => {
            const saved = localStorage.getItem('blog_data');
            if (saved) {
                POSTS_DATA = JSON.parse(saved);
            } else {
                POSTS_DATA = [{
                    id: 1, title: "Initial Post", excerpt: "Welcome to your blog.", 
                    image: "https://via.placeholder.com/800x400", date: "Jan 1, 2024", author: "Admin", content: "Start writing..."
                }];
            }
            renderFeed();
        };

        function previewImage(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    base64Image = e.target.result;
                    document.getElementById('file-label').innerText = "Image selected: " + file.name;
                    document.getElementById('post-image-url').value = ""; // Clear URL if file selected
                };
                reader.readAsDataURL(file);
            }
        }

        function handlePostSubmit(e) {
            e.preventDefault();
            const urlInput = document.getElementById('post-image-url').value;
            const newPost = {
                id: Date.now(),
                title: document.getElementById('post-title').value,
                excerpt: document.getElementById('post-excerpt').value,
                image: base64Image || urlInput || "https://via.placeholder.com/800x400",
                date: new Date().toLocaleDateString(),
                author: "Admin",
                content: document.getElementById('post-excerpt').value // Simplified for demo
            };

            POSTS_DATA.unshift(newPost);
            localStorage.setItem('blog_data', JSON.stringify(POSTS_DATA));
            base64Image = "";
            e.target.reset();
            document.getElementById('file-label').innerText = "Click to upload image or enter URL below";
            renderFeed();
            showHome();
        }

        async function syncToGitHub() {
            const token = document.getElementById('gh-token').value;
            const repo = document.getElementById('gh-repo').value;
            const status = document.getElementById('sync-status');

            if (!token || !repo) {
                status.innerText = "Error: Token and Repo required.";
                status.style.color = "red";
                return;
            }

            status.innerText = "Syncing...";
            status.style.color = "blue";

            try {
                const path = "data.json";
                const url = `https://api.github.com/repos/${repo}/contents/${path}`;
                
                // 1. Get current file SHA (if exists)
                let sha = "";
                const getFile = await fetch(url, {
                    headers: { 'Authorization': `token ${token}` }
                });
                
                if (getFile.ok) {
                    const data = await getFile.json();
                    sha = data.sha;
                }

                // 2. Push updated data
                const content = btoa(JSON.stringify(POSTS_DATA, null, 2));
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: "Update data.json via CMS",
                        content: content,
                        sha: sha
                    })
                });

                if (response.ok) {
                    status.innerText = "Success! data.json updated on GitHub.";
                    status.style.color = "green";
                } else {
                    const err = await response.json();
                    status.innerText = "Error: " + err.message;
                    status.style.color = "red";
                }
            } catch (e) {
                status.innerText = "Sync failed: " + e.message;
                status.style.color = "red";
            }
        }

        function renderFeed() {
            const container = document.getElementById('posts-container');
            container.innerHTML = POSTS_DATA.map(post => `
                <div class="post-card" onclick="showPost(${post.id})">
                    <img src="${post.image}" alt="">
                    <div class="post-card-body">
                        <h3 style="margin-bottom:0.5rem;">${post.title}</h3>
                        <p style="font-size:0.8rem; color:var(--text-muted);">${post.excerpt}</p>
                    </div>
                </div>
            `).join('');
        }

        function showPost(id) {
            const post = POSTS_DATA.find(p => p.id === id);
            const content = document.getElementById('post-detail-content');
            content.innerHTML = `
                <h1 style="margin-bottom:1rem;">${post.title}</h1>
                <img src="${post.image}" style="width:100%; border-radius:0.5rem; margin-bottom:1.5rem;">
                <p>${post.content}</p>
            `;
            toggleView('post-view');
        }

        function showHome() { toggleView('feed-view'); }
        function showAdmin() { toggleView('admin-view'); }

        function toggleView(id) {
            ['feed-view', 'admin-view', 'post-view'].forEach(v => {
                document.getElementById(v).classList.toggle('hidden', v !== id);
            });
        }
    </script>
</body>
</html>

